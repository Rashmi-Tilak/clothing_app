{% extends 'index.html' %}

{% block content %}
{% load static %}
<html lang="en">
<head>
     <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/responsive.css">
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        /* style.css */

/* Reset some default browser styles */
body, ul, li {
    margin: 0;
    padding: 0;
    list-style: none;
}

/* Center the content vertically and horizontally */
.product-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
    background-color: #f0f0f0; /* Optional: Set the background color */
}

/* Style the product list and items */
.product-list {
    margin-top: 20px;
}

.product-item {
    border: 1px solid #ccc;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 8px;
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
    background-color: #fff;
}

.product-name {
    font-size: 24px;
    color: #333;
}

.product-description {
    font-size: 16px;
    color: #555;
    margin-bottom: 10px;
}

.product-price {
    font-size: 18px;
    font-weight: bold;
    color: #00b300; /* Green color for price */
}

/* Style the images and variants */
.product-subtitle {
    font-size: 18px;
    font-weight: bold;
    margin-top: 10px;
    margin-bottom: 5px;
}
 .image-scroll-container {
            max-height: 200px; /* Set the maximum height for the scrolling window */
            overflow: hidden; /* Hide the overflow to create the scrolling effect */
            white-space: nowrap; /* Prevent images from wrapping to a new line */
            display: flex; /* Use flexbox to align images */
            align-items: center; /* Center images vertically */
            transition: transform 0.3s; /* Smooth scrolling transition */
        }

        /* Style the individual image item */
        .image-item {
            padding: 5px;
            /* Optionally, you can add a fixed width to each image to keep them in a grid-like layout */
            max-width: 100px;
            display: inline-block; /* Display images side by side */
        }

        .image-item img {
            max-width: 100%;
            max-height: 100px;
        }
.variant-list {
    margin-top: 10px;
}

.variant-item {
    font-size: 14px;
    color: #666;
}
.variant-list {
        margin-top: 10px;
    }

.variant-item {
    font-size: 14px;
    color: #666;
}

/* Style the size checkbox */
.size-checkbox {
    margin-right: 10px;
}
.image-scroll-container {
    max-height: 200px; /* Set the maximum height for the scrolling window */
    overflow-y: auto; /* Enable vertical scrolling */
}
 .disabledButton {
            background-color: gray;
            cursor: not-allowed;
        }


.itemAddedButton {
    background-color: green !important;
    pointer-events: none !important;
}

 .color-circle {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-left: 10px;
            border: 2px solid #ccc;
            cursor: pointer; /* Add cursor pointer to indicate it's clickable */
        }

        .green {
        background-color: green;
    }

    .yellow {
        background-color: yellow;
    }

    .red {
        background-color: red;
    }

     .blue {
        background-color: blue;
    }

     .white {
        background-color: white;
    }

    .black {
        background-color: black;
    }

     .violet {
        background-color: violet;
    }

    .orange {
        background-color: orange;
    }

    .selected {
    border: 2px solid black;
}
 .translucent {
    opacity: 0.9; /* Set the opacity to make it translucent */
    pointer-events: none; /* Disable pointer events on the translucent circle */
}

.translucent .cross-symbol {
    /* Reset the opacity and pointer events for the cross symbol */
    opacity: 1;
    pointer-events: auto;
}

.card-body-custom{
height:100%;
weidth:100%;
}

    </style>
</head>
<body>
  <div class="container my-5">
      <div class="row">
       <h3>Product Detail</h3>

          <div class="col-md-6">
        <ul class="product-list">
            {% for product in result_list %}
            <li class="product-item">



                    <h2 class="product-name">{{ product.name }}</h2>

                      <div class="card-body-custom">


<!--                    {% if product.images %}-->

<!--                    <div class="image-scroll-container">-->
<!--                        <ul class="image-list">-->
<!--                            {% for image in product.images %}-->
<!--                                <li class="image-item"><img src="{{ image }}" alt="Product Image"></li>-->
<!--                            {% endfor %}-->
<!--                        </ul>-->
<!--                    </div>-->
<!--                    {% endif %}-->

                           <section class="banner">
                                <div class="banner-container">
                                    <div id="carouselExampleIndicators" class="carousel slide banner-carousel" data-bs-ride="carousel">
                                        <div class="carousel-indicators">
                                            <!-- Add the carousel indicators here -->
                                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                            <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                                        </div>
                                        <div class="carousel-inner">
                                            <!-- Add the carousel slide images here -->
                                            {% if product.images %}
                                                {% for image in product.images %}
                                                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                                        <img src="{{ image }}" alt="Product Image" width="400" height="480" style="object-fit:contain;">
                                                    </div>
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </button>
                                    </div>
                                </div>
                        </section>












    <!--                {% if product.variants %}-->
    <!--                    <h3 class="product-subtitle">Variants:</h3>-->
    <!--                    <ul class="variant-list">-->
    <!--                        {% for variant in product.variants %}-->
    <!--                        <li class="variant-item">-->
    <!--                            <input type="checkbox" data-item-id="{{ product.product_id }}" class="size-checkbox" name="size" value="{{ variant.size }}" {% if product.disable %}disabled{% endif %}>-->
    <!--                            <label {% if product.disable %}style="color: blue;"{% endif %}>Size: {{ variant.size }}</label>-->
    <!--                            <input type="checkbox" data-item-id="{{ product.product_id }}" class="color-checkbox" name="color" value="{{ variant.color }}" {% if product.disable %}disabled{% endif %}>-->
    <!--                            <label {% if product.disable %}style="color: blue;"{% endif %}>Color: {{ variant.color }}</label>-->
    <!--                        </li>-->
    <!--                        {% endfor %}-->
    <!--                    </ul>-->

    <!--                {% endif %}-->
                      </div>
                </li>

                {% endfor %}

            </ul>
          </div>
                <div class="col-md-6">
                    <div class="container my-5">
               {% for product in result_list %}

                           <p class="product-description">{{ product.description }}</p>
                    <p class="product-price">Price: ${{ product.price }}</p>
                      <label for="size-select-{{ product.product_id }}">Select Size:</label>
                                    <select id="size-select-{{ product.product_id }}">
                                        {% for size in product.unique_sizes %}
                                            <option value="{{ size }}">{{ size }}</option>
                                        {% endfor %}
                                    </select>



                    <div class="color-circles-container" data-product-id="{{ product.product_id }}">
                        {% for variant in product.variants %}
                            {% if variant.size and variant.color %}
                             <div class="color-circle {% if variant.quantity_status %}disabled{% endif %} {% if variant.color_status %}translucent{% endif %} {{ variant.color | lower }}" data-size="{{ variant.size }}">
                                    {% if variant.quantity_status %}
                                        <div class="cross-symbol">X</div>
                                    {% endif %}
                             </div>
                                  {% endif %}
                        {% endfor %}
                    </div>
  <button class="addToCartButton" data-item-id="{{ product.product_id }}" style="background-color: {% if product.disable %}gray{% else %}black{% endif %}; color: white;width: 140px; height: 35px;font-weight: bold;" onclick="addToCart({{ product.product_id }})" {% if product.disable %}disabled{% endif %}>Add to cart</button>


                    <button id="wishlistButton" class="addToWishlistButton" data-item-id="{{ product.product_id }}" data-wish-status="{{ product.wish_status_disable }}" onclick="addToWishlist({{ product.product_id }})" style="background-color: {% if product.wish_status_disable %}red{% else %}black{% endif %}; color: white;width: 140px; height: 35px;font-weight: bold;" {% if product.wish_status_disable %}disabled{% endif %}>WishList</button>

                    <p class="error-message alert-error" style="display: none;color:red" id="error-message-{{ product.product_id }}">Please select color and size before adding to cart.</p>

                    </div>

                 </div>

      </div>








    <!--                {% if product.variants %}-->
    <!--                    <h3 class="product-subtitle">Variants:</h3>-->
    <!--                    <ul class="variant-list">-->
    <!--                        {% for variant in product.variants %}-->
    <!--                        <li class="variant-item">-->
    <!--                            <input type="checkbox" data-item-id="{{ product.product_id }}" class="size-checkbox" name="size" value="{{ variant.size }}" {% if product.disable %}disabled{% endif %}>-->
    <!--                            <label {% if product.disable %}style="color: blue;"{% endif %}>Size: {{ variant.size }}</label>-->
    <!--                            <input type="checkbox" data-item-id="{{ product.product_id }}" class="color-checkbox" name="color" value="{{ variant.color }}" {% if product.disable %}disabled{% endif %}>-->
    <!--                            <label {% if product.disable %}style="color: blue;"{% endif %}>Color: {{ variant.color }}</label>-->
    <!--                        </li>-->
    <!--                        {% endfor %}-->
    <!--                    </ul>-->

    <!--                {% endif %}-->


          </div>
      </div>




    </div>
  {% endfor %}

<script>

    function showErrorMessage(productId) {
            const errorMessage = document.querySelector(`#error-message-${productId}`);
            errorMessage.style.display = 'block';
        }

    // Function to hide error message for a specific product
    function hideErrorMessage(productId) {
        const errorMessage = document.querySelector(`#error-message-${productId}`);
        errorMessage.style.display = 'none';
    }

     const sizeSelects = document.querySelectorAll('[id^="size-select-"]');
    const colorCirclesContainers = document.querySelectorAll('.color-circles-container');

    function handleColorCircleSelection(colorCircles, selectedSize) {
        colorCircles.forEach(circle => {
            const circleSize = circle.dataset.size;
            if (circleSize === selectedSize) {
                circle.style.display = 'inline-block';
            } else {
                circle.style.display = 'none';
            }
        });
    }

    // Show color circles associated with the initially selected size(s)
    sizeSelects.forEach((sizeSelect, index) => {
        const selectedSize = sizeSelect.value;
        const colorCircles = colorCirclesContainers[index].querySelectorAll('.color-circle');
        handleColorCircleSelection(colorCircles, selectedSize);
    });

    // Set up event listeners for size select changes
    sizeSelects.forEach((sizeSelect, index) => {
        sizeSelect.addEventListener('change', function () {
            const selectedSize = this.value;
            const colorCircles = colorCirclesContainers[index].querySelectorAll('.color-circle');
            handleColorCircleSelection(colorCircles, selectedSize);
        });
    });


    // Set up event listeners for color circle clicks
    const colorCircles = document.querySelectorAll('.color-circle');
    colorCircles.forEach(circle => {
        circle.addEventListener('click', function () {
            if (!circle.classList.contains('disabled')) {
                // If the color circle is not disabled, remove 'selected' class from all color circles
                colorCircles.forEach(circle => {
                    circle.classList.remove('selected');
                });

                // Add 'selected' class to the clicked color circle
                this.classList.add('selected');
            }
        });
    });


     apiCallCount = 0
     function isCartButtonDisabled(productId)
      {
            // Check if the button is already disabled for the specific product
            return localStorage.getItem(`cartButtonDisabled_${productId}`) === 'true';
      }




<!--     function setItemAddedText(productId)-->
<!--     {-->
<!--      const cartButton = document.querySelector(`button.addToCartButton[data-item-id="${productId}"]`);-->
<!--      console.log("cartButton",cartButton)-->
<!--&lt;!&ndash;      cartButton.textContent = 'Item Added';&ndash;&gt;-->
<!--&lt;!&ndash;      cartButton.classList.add('itemAddedButton');&ndash;&gt;-->
<!--      cartButton.style.width = '140px'; // Set the width to the original width of the button-->
<!--    }-->

<!--     function isCheckboxesDisabled(productId)-->
<!--      {-->
<!--            // Check if the button is already disabled for the specific product-->
<!--            return localStorage.getItem(`checkboxDisabled_${productId}`) === 'true';-->
<!--      }-->

<!--    function disableCheckboxes(productId) {-->
<!--      // Disable the size and color checkboxes for the specific product-->
<!--      const sizeCheckboxes = document.querySelectorAll(`input[type="checkbox"].size-checkbox[data-item-id="${productId}"]`);-->
<!--      const colorCheckboxes = document.querySelectorAll(`input[type="checkbox"].color-checkbox[data-item-id="${productId}"]`);-->

<!--      sizeCheckboxes.forEach((checkbox) => {-->
<!--        checkbox.disabled = true;-->
<!--        // Store the disabled state in session storage with a unique key for each checkbox-->
<!--        localStorage.setItem(`checkboxDisabled_${productId}_${checkbox.id}`, 'true');-->
<!--      });-->

<!--      colorCheckboxes.forEach((checkbox) => {-->
<!--        checkbox.disabled = true;-->
<!--        // Store the disabled state in session storage with a unique key for each checkbox-->
<!--        localStorage.setItem(`checkboxDisabled_${productId}_${checkbox.id}`, 'true');-->
<!--      });-->
<!--    }-->


    function disableCartButton(productId)
    {
        // Disable the cart button and store its state in the session storage
        localStorage.setItem(`cartButtonDisabled_${productId}`, 'true');
        const cartButton = document.querySelector(`button.addToCartButton[data-item-id="${productId}"]`);
        cartButton.disabled = true;
    }




<!--       function addToCart(productId) {-->
<!--       console.log("*****",isCartButtonDisabled(productId))-->
<!--        if (isCartButtonDisabled(productId)) {-->
<!--            // If the cart button is already disabled, do not proceed-->
<!--            return;-->
<!--        }-->
<!--        if (isCheckboxesDisabled(productId)) {-->
<!--           return;-->
<!--        }-->

<!--        const selectedSizes = document.querySelectorAll(`input[type="checkbox"].size-checkbox[data-item-id="${productId}"]:checked`);-->
<!--        const selectedColors = document.querySelectorAll(`input[type="checkbox"].color-checkbox[data-item-id="${productId}"]:checked`);-->


<!--        if (selectedSizes.length === 0 || selectedColors.length === 0) {-->
<!--            alert('Please select a size and a color before adding to the cart.');-->
<!--            return;-->
<!--        }-->

<!--        // Create arrays to store the selected size and color variants-->
<!--        const selectedSizeVariants = [];-->
<!--        const selectedColorVariants = [];-->

<!--        selectedSizes.forEach((checkbox) => {-->
<!--            selectedSizeVariants.push(checkbox.value);-->
<!--        });-->

<!--        selectedColors.forEach((checkbox) => {-->
<!--            selectedColorVariants.push(checkbox.value);-->
<!--        });-->

<!--        // Prepare the data to be sent in the POST request-->
<!--        const data = {-->
<!--            product_id: productId,-->
<!--            size_variants: selectedSizeVariants,-->
<!--            color_variants: selectedColorVariants,-->
<!--        };-->

<!--        // Send the POST request to the cart API endpoint-->
<!--        fetch('/cart', {-->
<!--            method: 'POST',-->
<!--            headers: {-->
<!--                'Content-Type': 'application/json',-->
<!--                'X-CSRFToken': '{{ csrf_token }}', // Include the CSRF token if you are using it for CSRF protection-->
<!--            },-->
<!--            body: JSON.stringify(data),-->
<!--        })-->
<!--       .then((response) => {-->
<!--            if (response.ok) {-->
<!--                return response.json()-->
<!--                    .catch((error) => {-->
<!--                        throw new Error('Failed to parse JSON response from the server.');-->
<!--                    })-->
<!--                    .then((responseData) => {-->
<!--                        console.log("Response Data:", responseData);-->
<!--                        return responseData; // Return the parsed JSON data-->
<!--                    });-->
<!--            } else {-->
<!--                throw new Error('Failed to add the product to the cart.');-->
<!--            }-->
<!--        })-->
<!--        .then((responseData) => {-->
<!--            console.log("Inside hear")-->
<!--            // Process the responseData and update the cart view accordingly-->
<!--            // Optionally, you can display a success message to the user indicating that the product has been added to the cart.-->
<!--&lt;!&ndash;            alert('Product added to cart successfully.');&ndash;&gt;-->
<!--            setItemAddedText(productId);-->
<!--            disableCartButton(productId);-->


      function addToCart(productId) {

             if (isCartButtonDisabled(productId)) {
                // Display a message indicating that the item is already added to the cart
                alert('Item is already added to the cart.');
                return;
            }
            // Find the selected color circle
            console.log("****",document.querySelector(`.color-circles-container[data-product-id="${productId}"]`))
            const colorCirclesContainer = document.querySelector(`.color-circles-container[data-product-id="${productId}"]`);
            const selectedColorCircle = colorCirclesContainer.querySelector('.color-circle.selected');
            const sizeSelect = document.querySelector(`#size-select-${productId}`);
            const selectedSize = sizeSelect.value;


            const errorMessage = document.querySelector('.error-message');
            if (!selectedColorCircle) {
                // Show the error message if the color is not selected
<!--                errorMessage.style.display = 'block';-->
                showErrorMessage(productId);
            } else {
                const selectedColor = selectedColorCircle.classList[1]; // Get the color class from the selected circle



        // Color and size are selected, send the data to the server
        // You can use the Fetch API to make an HTTP request to your cart API


        const data = {
            product_id: productId,
            color_variants: selectedColor,
            size_variants: selectedSize,
        };

        fetch('/cart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to add product to cart.');
            }
            return response.json();
        })
        .then(responseData => {
            // Handle the response from the server if necessary
            console.log('Product added to cart successfully:', responseData);
            window.location.reload();
            // If successful, you may hide the error message (if it was previously shown)
            disableCartButton(productId);
            errorMessage.style.display = 'none';

        })
        .catch(error => {
            // Handle errors
            console.error('Error adding product to cart:', error);
            errorMessage.style.display = 'block';
        });

            }
        }


     function addToWishlist(productId) {
       console.log("*****",isCartButtonDisabled(productId))



        // Prepare the data to be sent in the POST request
        const data = {
            product_id: productId,
        };

        // Send the POST request to the cart API endpoint
        fetch('/wishlist', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}', // Include the CSRF token if you are using it for CSRF protection
            },
            body: JSON.stringify(data),
        })
       .then((response) => {
            console.log("response ******",response)
            if (response.ok) {
                return response.json()
                    .catch((error) => {
                        throw new Error('Failed to parse JSON response from the server.');
                    })
                    .then((responseData) => {
                        console.log("Response Data:", responseData);
                        window.location.reload();
                        return responseData; // Return the parsed JSON data
                    });
            } else {
                throw new Error('Failed to add the product to the wishlist.');
            }
        })
        .then((responseData) => {
            console.log("Inside hear")


        })
        .catch((error) => {
            console.error("this is the error", error);
            alert('Failed to add the product to the wishlist. Please try again.');
        });
    }





     document.addEventListener('DOMContentLoaded', () => {
        const cartButtons = document.querySelectorAll('button.addToCartButton');
        cartButtons.forEach((cartButton) => {
            const productId = cartButton.dataset.itemId;
            if (isCartButtonDisabled(productId)) {
                cartButton.disabled = true;
                cartButton.classList.add('disabledButton');
            }
        });
    });


    </script>

</body>
</html>
{% endblock %}